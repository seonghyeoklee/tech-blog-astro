---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// 모든 태그 추출
const allTags = ['Java', 'Kotlin', 'Spring', 'Architecture', 'Database', 'MySQL', 'JPA', 'Redis', 'Kafka', 'Docker', 'Kubernetes', 'AWS'];
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main {
				width: 960px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 3em 1em;
			}

			/* 히어로 섹션 */
			.hero {
				text-align: center;
				margin-bottom: 3em;
				padding: 2em 0;
			}
			.hero h1 {
				font-size: 2.5em;
				margin: 0 0 0.5em 0;
				color: rgb(var(--black));
			}
			.hero p {
				color: rgb(var(--gray));
				font-size: 1.1em;
				margin: 0;
			}

			/* 태그 필터 */
			.tag-filter {
				display: flex;
				justify-content: center;
				gap: 0.8em;
				margin-bottom: 2.5em;
				flex-wrap: wrap;
			}
			.filter-btn {
				padding: 0.5em 1.2em;
				border-radius: 20px;
				border: 2px solid rgb(var(--gray-light));
				background: transparent;
				cursor: pointer;
				font-size: 0.9em;
				font-weight: 600;
				transition: all 0.2s ease;
				color: rgb(var(--gray-dark));
			}
			.filter-btn:hover {
				border-color: var(--accent);
				color: var(--accent);
			}
			.filter-btn.active {
				background: var(--accent);
				border-color: var(--accent);
				color: white;
			}
			.filter-btn[data-tag="Java"].active {
				background: #f89820;
				border-color: #f89820;
			}
			.filter-btn[data-tag="Kotlin"].active {
				background: #7F52FF;
				border-color: #7F52FF;
			}
			.filter-btn[data-tag="Spring"].active {
				background: #6DB33F;
				border-color: #6DB33F;
			}
			.filter-btn[data-tag="Architecture"].active {
				background: #3498db;
				border-color: #3498db;
			}
			.filter-btn[data-tag="Database"].active {
				background: #336791;
				border-color: #336791;
			}
			.filter-btn[data-tag="MySQL"].active {
				background: #4479A1;
				border-color: #4479A1;
			}
			.filter-btn[data-tag="JPA"].active {
				background: #59666C;
				border-color: #59666C;
			}
			.filter-btn[data-tag="Redis"].active {
				background: #DC382D;
				border-color: #DC382D;
			}
			.filter-btn[data-tag="Kafka"].active {
				background: #231F20;
				border-color: #231F20;
			}
			.filter-btn[data-tag="Docker"].active {
				background: #2496ED;
				border-color: #2496ED;
			}
			.filter-btn[data-tag="Kubernetes"].active {
				background: #326CE5;
				border-color: #326CE5;
			}
			.filter-btn[data-tag="AWS"].active {
				background: #FF9900;
				border-color: #FF9900;
			}

			/* 글 목록 */
			.posts-section h2 {
				font-size: 1.3em;
				margin-bottom: 1.5em;
				color: rgb(var(--gray));
				font-weight: 500;
			}
			.post-list {
				list-style: none;
				padding: 0;
				margin: 0;
			}
			.post-item {
				padding: 1.5em 0;
				border-bottom: 1px solid rgb(var(--gray-light));
			}
			.post-item:last-child {
				border-bottom: none;
			}
			.post-link {
				text-decoration: none;
				display: block;
			}
			.post-link:hover .post-title {
				color: var(--accent);
			}
			.post-header {
				display: flex;
				justify-content: space-between;
				align-items: flex-start;
				gap: 1em;
				margin-bottom: 0.5em;
			}
			.post-title {
				font-size: 1.25em;
				margin: 0;
				color: rgb(var(--black));
				line-height: 1.4;
				transition: color 0.2s ease;
			}
			.post-date {
				color: rgb(var(--gray));
				font-size: 0.85em;
				white-space: nowrap;
			}
			.post-description {
				color: rgb(var(--gray));
				font-size: 0.95em;
				margin: 0.5em 0;
				line-height: 1.6;
			}
			.post-tags {
				display: flex;
				gap: 0.5em;
				margin-top: 0.8em;
				flex-wrap: wrap;
			}
			.tag {
				font-size: 0.75em;
				padding: 0.25em 0.7em;
				border-radius: 4px;
				font-weight: 600;
			}
			.tag-java {
				background-color: #f89820;
				color: white;
			}
			.tag-kotlin {
				background-color: #7F52FF;
				color: white;
			}
			.tag-spring {
				background-color: #6DB33F;
				color: white;
			}
			.tag-architecture {
				background-color: #3498db;
				color: white;
			}
			.tag-database {
				background-color: #336791;
				color: white;
			}
			.tag-mysql {
				background-color: #4479A1;
				color: white;
			}
			.tag-jpa {
				background-color: #59666C;
				color: white;
			}
			.tag-redis {
				background-color: #DC382D;
				color: white;
			}
			.tag-kafka {
				background-color: #231F20;
				color: white;
			}
			.tag-docker {
				background-color: #2496ED;
				color: white;
			}
			.tag-kubernetes {
				background-color: #326CE5;
				color: white;
			}
			.tag-aws {
				background-color: #FF9900;
				color: white;
			}

			/* 빈 상태 */
			.empty-state {
				text-align: center;
				padding: 3em;
				color: rgb(var(--gray));
			}
			.empty-state p {
				font-size: 1.1em;
			}

			/* 글 개수 */
			.post-count {
				color: rgb(var(--gray));
				font-size: 0.9em;
				margin-bottom: 1em;
			}

			@media (max-width: 720px) {
				.hero h1 {
					font-size: 2em;
				}
				.post-header {
					flex-direction: column;
					gap: 0.3em;
				}
				.post-title {
					font-size: 1.1em;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<!-- 히어로 섹션 -->
			<div class="hero">
				<h1>shlee.dev</h1>
				<p>매일 조금씩, 개발 기록</p>
			</div>

			<!-- 태그 필터 -->
			<div class="tag-filter">
				<button class="filter-btn active" data-tag="all">All</button>
				{allTags.map((tag) => (
					<button class="filter-btn" data-tag={tag}>{tag}</button>
				))}
			</div>

			<!-- 글 목록 -->
			<section class="posts-section">
				<p class="post-count" id="post-count">{posts.length}개의 글</p>

				{posts.length === 0 ? (
					<div class="empty-state">
						<p>아직 작성된 글이 없습니다.</p>
					</div>
				) : (
					<ul class="post-list" id="post-list">
						{posts.map((post) => (
							<li class="post-item" data-tags={post.data.tags?.join(',') || ''}>
								<a href={`/blog/${post.id}/`} class="post-link">
									<div class="post-header">
										<h3 class="post-title">{post.data.title}</h3>
										<span class="post-date">
											<FormattedDate date={post.data.pubDate} />
										</span>
									</div>
									<p class="post-description">{post.data.description}</p>
									{post.data.tags && (
										<div class="post-tags">
											{post.data.tags.map((tag) => (
												<span class={`tag tag-${tag.toLowerCase()}`}>{tag}</span>
											))}
										</div>
									)}
								</a>
							</li>
						))}
					</ul>
				)}
			</section>
		</main>
		<Footer />

		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const filterBtns = document.querySelectorAll('.filter-btn');
				const postItems = document.querySelectorAll('.post-item');
				const postCount = document.getElementById('post-count');

				filterBtns.forEach(btn => {
					btn.addEventListener('click', () => {
						// 버튼 활성화 상태 변경
						filterBtns.forEach(b => b.classList.remove('active'));
						btn.classList.add('active');

						const selectedTag = btn.getAttribute('data-tag');
						let visibleCount = 0;

						postItems.forEach(item => {
							const itemTags = item.getAttribute('data-tags') || '';

							if (selectedTag === 'all' || itemTags.includes(selectedTag)) {
								(item as HTMLElement).style.display = 'block';
								visibleCount++;
							} else {
								(item as HTMLElement).style.display = 'none';
							}
						});

						// 글 개수 업데이트
						if (postCount) {
							postCount.textContent = `${visibleCount}개의 글`;
						}
					});
				});
			});
		</script>
	</body>
</html>
