---
term: 'Sharding'
aliases: ['샤딩', '수평 분할', 'Horizontal Partitioning']
category: 'database'
summary: '데이터를 여러 서버에 분산 저장하는 수평 확장 기법. 각 서버(샤드)가 데이터의 일부를 담당'
related: [redis, mongodb, replication]
---

## 정의

샤딩은 하나의 데이터셋을 여러 서버(샤드)에 나누어 저장하는 수평 확장 기법입니다. 각 샤드는 전체 데이터의 일부만 저장합니다.

## 샤딩 전략

| 전략 | 방식 | 장단점 |
|------|------|--------|
| Range | 키 범위로 분할 (A-M, N-Z) | 핫스팟 발생 가능 |
| Hash | 해시 값으로 분할 | 균등 분산, 범위 쿼리 어려움 |
| Directory | 매핑 테이블 사용 | 유연함, 추가 조회 필요 |

## 구조

```
┌─────────┐   ┌─────────┐   ┌─────────┐
│ Shard 1 │   │ Shard 2 │   │ Shard 3 │
│  A-M    │   │  N-S    │   │  T-Z    │
└────┬────┘   └────┬────┘   └────┬────┘
     │             │             │
     └──────┬──────┴─────────────┘
            │
      ┌─────┴─────┐
      │  Router   │  ← 샤드 키로 라우팅
      └───────────┘
```

## 샤드 키 선택

좋은 샤드 키 조건:
- **높은 카디널리티**: 다양한 값 분포
- **균등 분산**: 특정 샤드에 집중 방지
- **쿼리 패턴 고려**: 자주 함께 조회되는 데이터는 같은 샤드에

```javascript
// MongoDB 샤드 키 설정
sh.shardCollection("db.orders", { "user_id": "hashed" })
```

## 주의사항

- **Cross-shard 쿼리**: 여러 샤드 조회 시 성능 저하
- **JOIN 제한**: 샤드 간 JOIN 불가 또는 비효율
- **리밸런싱**: 샤드 추가/제거 시 데이터 재분배 필요
- **트랜잭션**: 단일 샤드 내에서만 원자성 보장

## vs 복제(Replication)

```
샤딩: 데이터 분할 → 용량/처리량 확장
복제: 데이터 복사 → 가용성/읽기 성능 향상
실무: 샤딩 + 복제 조합 사용
```
